{% extends "base.html" %}
{% block title %} Home {% endblock %}

{% block typerf %}
<nav id="navb1" class="navbar border-bottom z-2 bg-white d-none d-lg-block">
  <div class="m-auto container d-flex justify-content-evenly">
    <a href="{{ url_for('index') }}" class="nav-link active">Tutti</a>
    <a href="{{ url_for('lampo') }}" class="nav-link">Lampo</a>
    <a href="{{ url_for('normale') }}" class="nav-link">Normale</a>
    <a href="{{ url_for('halloffame') }}" class="nav-link">Hall of fame</a>
  </div>
</nav>
{% endblock %}

{% block content %}

<section class="container mx-auto mb-2 col-lg-12">
  <h2 class="text-center">Dai vita al tuo pane</h2>

  <div class="bg-body-tertiary mb-3 mx-auto mt-4 col-lg-auto shadow-sm p-3 mb-5">
    <div class="row">
      <div class="col m-3 border-end">
        <h5 class="text-center">Progetti totali</h5>
        <h2 class="text-center text-banner">{{ progetti_totali }}</h2>
      </div>
      <div class="col-md border-end d-none d-md-block m-3">
        <h5 class="text-center">â‚¬ totali</h5>
        <h2 class="text-center text-banner">{{ totale_globale_donazioni }}â‚¬</h2>
      </div>
      <div class="col m-3">
        <h5 class="text-center">nÂ° totali donazioni su Dough Finder</h5>
        <h2 class="text-center text-banner">{{ donazioni_globali_totali }}</h2>
      </div>
    </div>
  </div>
</section>

{% if len > 5 and len_donazioni > 2 %}

<section class="container mx-auto mb-2 col-lg-12">
  <div class="mb-3 mt-4 col-lg-auto">
    <h5 class="m-0">On fire ðŸ”¥</h5>

    <div class="row d-flex flex-nowrap">

      {# CARD GRANDE #}
      <div class="col-5 pe-3 border-end img_div">

        {% if onfire.tipo == 1 %}
        <div class="lampo_tag_fire">
          &nbsp
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightning-fill icons" viewBox="0 0 16 16">
            <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"/>
          </svg>
          Lampo &nbsp
        </div>
        {% endif %}

        <div class="mt-2">
          <img src="{{ onfire.img | img_url }}" class="post crop" alt="...">

          <div class="p-3">
            <h5 class="card-title">{{ onfire.titolo }}</h5>
            <p class="card-text">{{ onfire.descrizione }}</p>
            <a href="{{ url_for('rf_singolo', id=onfire.id) }}" class="btn btn-primary">Scopri di piÃ¹!</a>
          </div>
        </div>
      </div>

      {# LISTA PICCOLA #}
      <div class="col-md-8 mt-2 img_div">
        {% for onfire_item in onfire23 %}

          {% if onfire_item.tipo == 1 %}
          <div class="lampo_tag_fire2">
            &nbsp
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightning-fill icons" viewBox="0 0 16 16">
              <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"/>
            </svg>
            Lampo &nbsp
          </div>
          {% endif %}

          <div class="margine-e mb-3">
            <div class="col ms-3">
              <img src="{{ onfire_item.img | img_url }}" class="post_small" alt="...">
            </div>

            <div class="ms-3">
              <h5 class="mt-2">{{ onfire_item.titolo }}</h5>
              <p class="card-text">{{ onfire_item.descrizione }}</p>
              <a href="{{ url_for('rf_singolo', id=onfire_item.id) }}" class="btn btn-primary">Scopri di piÃ¹!</a>
            </div>
          </div>
          <hr>

        {% endfor %}
      </div>

    </div>
  </div>
</section>


<main class="container mx-auto mb-2 col-lg-12 z-2">
  <div class="mb-3 mx-auto mt-4 col-lg-auto">
    <hr>
    <div class="row">
      <h5 class="mt-1 mb-3">I successi su Dough Finder</h5>

      {% for rf_archiviato in migliori %}
        <div class="col img_div pointers" onclick="window.location='{{ url_for('rf_singolo', id=rf_archiviato.id) }}'">

          {% if rf_archiviato.tipo == 1 %}
          <div class="lampo_tag z-1">
            &nbsp
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightning-fill icons" viewBox="0 0 16 16">
              <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"/>
            </svg>
            Lampo &nbsp
          </div>
          {% endif %}

          <div class="hover_successi">
            <h3 class="titolo_pop">&nbsp{{ rf_archiviato.titolo }}&nbsp</h3>
            <img src="{{ rf_archiviato.img | img_url }}" class="card-img img_card_popolari img_succ" alt="...">
          </div>

        </div>
      {% endfor %}
    </div>
    <hr>
  </div>

{% else %}
  &nbsp
{% endif %}

  <div class="align-items-start row">
    <h4 class="my-3">Sostieni le raccolte fondi</h4>

    {% for rf_singolo in rf | sort(attribute=['scadenza'][0], reverse=False) %}
      <div class="col-lg-3 col-md-4 mb-5 img_div">

        {% if rf_singolo.tipo == 1 %}
        <div class="lampo_tag">
          &nbsp
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightning-fill icons" viewBox="0 0 16 16">
            <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"/>
          </svg>
          Lampo &nbsp
        </div>
        {% endif %}

        <div>

          {# dropdown SOLO se proprietario #}
          {% if current_user.is_authenticated and current_user.id == rf_singolo.id_utente %}
            <a class="like_btn nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical ms-1 mb-1 me-1" viewBox="0 0 16 16">
                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
              </svg>
            </a>

            <ul class="dropdown-menu">
              <li>
                <form action="{{ url_for('edit_rf', id_rf=rf_singolo.id) }}" method="post">
                  <button class="dropdown-item" type="submit">Modifica</button>
                </form>
              </li>
              <li>
                {% if (rf_singolo.num_donazioni|default(0))|int > 0 %}
                  <span class="d-inline-block"
                        tabindex="0"
                        data-bs-toggle="tooltip"
                        data-bs-placement="left"
                        data-bs-title="Non puoi eliminare questa raccolta perchÃ© ha giÃ  ricevuto donazioni.">
                    <button class="dropdown-item" type="button" disabled>Elimina</button>
                  </span>
                {% else %}
                  <form action="{{ url_for('delete_rf', id_rf=rf_singolo.id) }}" method="post">
                    <button class="dropdown-item" type="submit"
                            onclick="return confirm('Sei sicuro di voler cancellare questa raccolta fondi?')">
                      Elimina
                    </button>
                  </form>
                {% endif %}
              </li>
            </ul>
          {% endif %}

          <img src="{{ rf_singolo.img | img_url }}"
               onclick="window.location='{{ url_for('rf_singolo', id=rf_singolo.id) }}'"
               class="img_card pointers" alt="...">

          <div onclick="window.location='{{ url_for('rf_singolo', id=rf_singolo.id) }}'">
            <section class="d-flex align-items-center justify-content-between my-2">
              <div class="col-7">
                <h5 class="no-b text-truncate">{{ rf_singolo.titolo }}</h5>
                <small class="text-name_post m-n3 no-m">di {{ rf_singolo.username }}</small>
              </div>
              <div class="text-end col-5">
                <p class="no-b text-success fw-bold">
                  {% set totale = tot_donazioni(donazioni, rf_singolo.id) %}
                  {% set perce = percentuale(totale, rf_singolo.obiettivo) %}
                  {{ perce }}% Finanziato
                </p>
                <time>
                  {% set tempo_mancante = tempo_scadenza(rf_singolo.scadenza, current) %}
                  {% if rf_singolo.stato == 0 %}{{ tempo_mancante }}{% endif %}
                </time>
              </div>
            </section>

            <p class="text-description fewlines">{{ rf_singolo.descrizione }}</p>
            <hr>
            <a href="{{ url_for('rf_singolo', id=rf_singolo.id) }}" class="nav-link text-center">
              <small>Scopri di piÃ¹</small>
            </a>
          </div>

        </div>
      </div>
    {% endfor %}

  </div>
</main>

{% endblock %}
